<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Generator Pro ‚Äî Crie v√≠deos incr√≠veis com IA</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <style>
        :root {
            /* Color Palette */
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-card: rgba(255, 255, 255, 0.03);
            --bg-card-hover: rgba(255, 255, 255, 0.05);

            --border-subtle: rgba(255, 255, 255, 0.08);
            --border-focus: rgba(139, 92, 246, 0.5);

            --text-primary: #ffffff;
            --text-secondary: #a1a1aa;
            --text-muted: #71717a;

            --accent-primary: #8b5cf6;
            --accent-hover: #7c3aed;
            --accent-glow: rgba(139, 92, 246, 0.4);

            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;

            /* Spacing */
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            --space-2xl: 48px;

            /* Border Radius */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;

            /* Transitions */
            --transition-fast: 150ms ease;
            --transition-default: 250ms ease;
            --transition-slow: 350ms ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* SVG Icons */
        .icon {
            width: 20px;
            height: 20px;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
            fill: none;
        }

        .icon-lg {
            width: 32px;
            height: 32px;
        }

        .icon-xl {
            width: 48px;
            height: 48px;
        }

        /* Background Effects */
        .bg-mesh {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background:
                radial-gradient(ellipse 80% 80% at 50% -20%, rgba(120, 119, 198, 0.15), transparent),
                radial-gradient(ellipse 60% 60% at 80% 0%, rgba(139, 92, 246, 0.1), transparent),
                radial-gradient(ellipse 50% 50% at 0% 100%, rgba(99, 102, 241, 0.08), transparent);
        }

        /* Main Layout */
        .app-container {
            display: flex;
            gap: var(--space-xl);
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-2xl);
            min-height: 100vh;
            align-items: flex-start;
        }

        /* Left Panel - Main Content */
        .main-panel {
            flex: 1;
            max-width: 680px;
            animation: fadeSlideUp 0.6s ease-out;
        }

        @keyframes fadeSlideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: var(--space-2xl);
        }

        .logo {
            display: inline-flex;
            align-items: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-md);
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: var(--accent-primary);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: 0 8px 32px var(--accent-glow);
        }

        .title {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--text-primary);
            letter-spacing: -0.02em;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 400;
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            margin-bottom: var(--space-lg);
            transition: all var(--transition-default);
        }

        .card:hover {
            background: var(--bg-card-hover);
            border-color: rgba(255, 255, 255, 0.12);
            transform: translateY(-2px);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-md);
        }

        .card-title {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .card-title-icon {
            color: var(--accent-primary);
            display: flex;
            align-items: center;
        }

        .card-badge {
            background: rgba(139, 92, 246, 0.15);
            color: #a78bfa;
            font-size: 0.75rem;
            font-weight: 500;
            padding: var(--space-xs) var(--space-sm);
            border-radius: 999px;
        }

        /* Form Elements */
        label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: var(--space-sm);
        }

        input[type="text"],
        textarea,
        select {
            width: 100%;
            padding: var(--space-md);
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.9375rem;
            transition: all var(--transition-default);
            outline: none;
        }

        input[type="text"]:hover,
        textarea:hover,
        select:hover {
            border-color: rgba(255, 255, 255, 0.15);
            background: rgba(255, 255, 255, 0.06);
        }

        input[type="text"]:focus,
        textarea:focus,
        select:focus {
            border-color: var(--border-focus);
            background: rgba(139, 92, 246, 0.05);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.15);
        }

        input::placeholder,
        textarea::placeholder {
            color: var(--text-muted);
        }

        textarea {
            resize: vertical;
            min-height: 140px;
            line-height: 1.7;
        }

        select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2371717a'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 20px;
            padding-right: 44px;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            padding: var(--space-md) var(--space-lg);
            border: none;
            border-radius: var(--radius-md);
            font-family: inherit;
            font-size: 0.9375rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-default);
            outline: none;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: var(--accent-primary);
            color: white;
            box-shadow: 0 4px 24px var(--accent-glow);
            width: 100%;
        }

        .btn-primary:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
            box-shadow: 0 8px 32px var(--accent-glow);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            background: var(--text-muted);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.06);
            color: var(--text-primary);
            border: 1px solid var(--border-subtle);
            width: 100%;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.15);
        }

        .btn-ghost {
            background: transparent;
            color: #a78bfa;
            padding: var(--space-sm) var(--space-md);
            font-size: 0.8125rem;
        }

        .btn-ghost:hover {
            background: rgba(139, 92, 246, 0.1);
        }

        /* Scenes Container */
        .scenes-grid {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }

        .scene-item {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-md);
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-md);
            transition: all var(--transition-default);
        }

        .scene-item:hover {
            background: rgba(255, 255, 255, 0.04);
            border-color: rgba(255, 255, 255, 0.12);
        }

        .scene-number {
            flex-shrink: 0;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(139, 92, 246, 0.15);
            color: #a78bfa;
            font-size: 0.75rem;
            font-weight: 600;
            border-radius: 50%;
        }

        .scene-input {
            flex: 1;
            padding: var(--space-sm) var(--space-md);
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.875rem;
            outline: none;
        }

        .scene-input::placeholder {
            color: var(--text-muted);
        }

        /* Right Panel - Status */
        .side-panel {
            width: 360px;
            position: sticky;
            top: var(--space-2xl);
            animation: fadeSlideUp 0.6s ease-out 0.2s both;
        }

        .status-card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-xl);
            padding: var(--space-xl);
            text-align: center;
        }

        .status-icon-wrapper {
            width: 80px;
            height: 80px;
            margin: 0 auto var(--space-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(139, 92, 246, 0.1);
            border-radius: 50%;
            color: var(--accent-primary);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(139, 92, 246, 0.4);
            }

            50% {
                transform: scale(1.05);
                box-shadow: 0 0 20px 10px rgba(139, 92, 246, 0);
            }
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .status-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: var(--space-sm);
            color: var(--text-primary);
        }

        .status-text {
            color: var(--text-secondary);
            font-size: 0.9375rem;
            line-height: 1.6;
            margin-bottom: var(--space-lg);
        }

        .preview-btn {
            background: var(--accent-primary);
            color: white;
            border: none;
            padding: var(--space-md) var(--space-lg);
            border-radius: var(--radius-md);
            font-family: inherit;
            font-size: 0.9375rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            box-shadow: 0 4px 24px var(--accent-glow);
            transition: all var(--transition-default);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
        }

        .preview-btn:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
            box-shadow: 0 8px 32px var(--accent-glow);
        }

        /* Upload Zone */
        .upload-zone {
            border: 2px dashed var(--border-subtle);
            border-radius: var(--radius-md);
            padding: var(--space-xl);
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-default);
            position: relative;
        }

        .upload-zone:hover,
        .upload-zone.dragover {
            border-color: var(--border-focus);
            background: rgba(139, 92, 246, 0.05);
        }

        .upload-zone.has-image {
            padding: var(--space-md);
            border-style: solid;
            border-color: var(--success);
        }

        .upload-icon {
            color: var(--text-secondary);
            margin-bottom: var(--space-sm);
            display: flex;
            justify-content: center;
        }

        .upload-text {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .upload-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: var(--radius-sm);
            object-fit: contain;
        }

        .upload-remove {
            position: absolute;
            top: var(--space-sm);
            right: var(--space-sm);
            background: var(--error);
            color: white;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
        }

        .upload-remove:hover {
            transform: scale(1.1);
        }

        /* Loading States */
        .loading-spinner {
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .app-container {
                flex-direction: column;
                align-items: center;
            }

            .main-panel {
                max-width: 100%;
            }

            .side-panel {
                width: 100%;
                max-width: 680px;
                position: relative;
                top: 0;
            }
        }

        @media (max-width: 640px) {
            .app-container {
                padding: var(--space-lg);
            }

            .title {
                font-size: 1.75rem;
            }

            .card {
                padding: var(--space-md);
            }
        }
    </style>
</head>

<body>
    <div class="bg-mesh"></div>

    <div class="app-container">
        <!-- Main Panel -->
        <div class="main-panel">
            <!-- Header -->
            <header class="header">
                <div class="logo">
                    <div class="logo-icon">
                        <!-- Feather Icon: film -->
                        <svg class="icon icon-lg" viewBox="0 0 24 24">
                            <rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"></rect>
                            <line x1="7" y1="2" x2="7" y2="22"></line>
                            <line x1="17" y1="2" x2="17" y2="22"></line>
                            <line x1="2" y1="12" x2="22" y2="12"></line>
                            <line x1="2" y1="7" x2="7" y2="7"></line>
                            <line x1="2" y1="17" x2="7" y2="17"></line>
                            <line x1="17" y1="17" x2="22" y2="17"></line>
                            <line x1="17" y1="7" x2="22" y2="7"></line>
                        </svg>
                    </div>
                </div>
                <h1 class="title">Video Generator</h1>
                <p class="subtitle">Crie v√≠deos profissionais com intelig√™ncia artificial</p>
            </header>

            <!-- Topic Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="card-title-icon">
                            <!-- Feather Icon: zap (using zap instead of lightbulb for 'idea/power') or lightbulb logic if preferred -->
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M12 2a6 6 0 0 1 6 6c0 7-3 9-3 9H9s-3-2-3-9a6 6 0 0 1 6-6z"></path>
                                <path d="M9 22h6"></path>
                                <path d="M10 19h4"></path>
                            </svg>
                        </span>
                        T√≥pico do V√≠deo
                    </div>
                </div>
                <input type="text" id="topic"
                    placeholder="Ex: Curiosidades sobre Caf√©, Fatos incr√≠veis sobre o universo...">
            </div>

            <!-- Script Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="card-title-icon">
                            <!-- Feather Icon: file-text -->
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <polyline points="10 9 9 9 8 9"></polyline>
                            </svg>
                        </span>
                        Roteiro
                    </div>
                    <span class="card-badge">Edit√°vel</span>
                </div>
                <textarea id="scriptText"
                    placeholder="O roteiro gerado pela IA aparecer√° aqui. Voc√™ pode editar livremente para personalizar seu v√≠deo..."></textarea>

                <!-- Moved Generate Script Button to here -->
                <button onclick="generateScript()" id="genScriptBtn" class="btn btn-secondary"
                    style="margin-top: var(--space-md); width: 100%; justify-content: center;">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path
                            d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z">
                        </path>
                    </svg>
                    Gerar Roteiro com IA
                </button>
            </div>

            <!-- Voice Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="card-title-icon">
                            <!-- Feather Icon: mic -->
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                                <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                                <line x1="12" y1="19" x2="12" y2="23"></line>
                                <line x1="8" y1="23" x2="16" y2="23"></line>
                            </svg>
                        </span>
                        Voz (ElevenLabs)
                    </div>
                </div>
                <select id="voice">
                    <option value="Sarah">Sarah ‚Äî Madura, Confiante</option>
                    <option value="Rachel">Rachel ‚Äî Natural, Multil√≠ngue</option>
                    <option value="Adam">Adam ‚Äî Masculino, Multil√≠ngue</option>
                    <option value="Roger">Roger ‚Äî Descontra√≠do</option>
                    <option value="Charlie">Charlie ‚Äî Profundo, En√©rgico</option>
                    <option value="Daniel">Daniel ‚Äî Jornalista, S√©rio</option>
                    <option value="Alice">Alice ‚Äî Educativa, Clara</option>
                </select>
            </div>

            <!-- Reference Image Upload Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="card-title-icon">
                            <!-- Feather Icon: camera -->
                            <svg class="icon" viewBox="0 0 24 24">
                                <path
                                    d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z">
                                </path>
                                <circle cx="12" cy="13" r="4"></circle>
                            </svg>
                        </span>
                        Imagem de Refer√™ncia
                    </div>
                    <span class="card-badge">Opcional</span>
                </div>
                <p style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: var(--space-md);">
                    Fa√ßa upload de uma imagem para influenciar o estilo das imagens geradas.
                </p>
                <div id="uploadZone" class="upload-zone">
                    <input type="file" id="referenceImageInput" accept="image/jpeg,image/png,image/webp"
                        style="display: none;">
                    <div id="uploadPlaceholder">
                        <div class="upload-icon">
                            <!-- Feather Icon: upload-cloud -->
                            <svg class="icon icon-lg" viewBox="0 0 24 24">
                                <polyline points="16 16 12 12 8 16"></polyline>
                                <line x1="12" y1="12" x2="12" y2="21"></line>
                                <path d="M20.39 18.39A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.3"></path>
                                <polyline points="16 16 12 12 8 16"></polyline>
                            </svg>
                        </div>
                        <div class="upload-text">Clique ou arraste uma imagem aqui</div>
                    </div>
                    <img id="uploadPreview" class="upload-preview" style="display: none;">
                    <button id="uploadRemoveBtn" class="upload-remove" style="display: none;">√ó</button>
                </div>
            </div>

            <!-- Scenes Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="card-title-icon">
                            <!-- Feather Icon: image -->
                            <svg class="icon" viewBox="0 0 24 24">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                <polyline points="21 15 16 10 5 21"></polyline>
                            </svg>
                        </span>
                        Cenas (Imagens)
                    </div>
                    <button onclick="generateProPrompts()" id="genPromptsBtn" class="btn btn-ghost">
                        <svg class="icon" style="margin-right: 4px;" viewBox="0 0 24 24">
                            <path d="M12 19l7-7 3 3-7 7-3-3z"></path>
                            <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>
                            <path d="M2 2l7.586 7.586"></path>
                            <circle cx="11" cy="11" r="2"></circle>
                        </svg>
                        Gerar Prompts Pro
                    </button>
                </div>
                <div id="scenes-container" class="scenes-grid">
                    <!-- Scenes will be generated by JS -->
                </div>
            </div>

            <!-- Generate Button -->
            <button onclick="generateVideo()" id="generateBtn" class="btn btn-primary">
                üöÄ Gerar V√≠deo
            </button>
        </div>

        <!-- Side Panel -->
        <div class="side-panel">
            <div class="status-card" id="statusCard">
                <div class="status-icon-wrapper">
                    <span id="statusIcon">
                        <!-- Feather Icon: sparkles (or star) -->
                        <svg class="icon icon-lg" viewBox="0 0 24 24">
                            <polygon
                                points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2">
                            </polygon>
                        </svg>
                    </span>
                </div>
                <h3 class="status-title" id="statusTitle">Pronto para Criar</h3>
                <p class="status-text" id="statusText">
                    Gere um roteiro primeiro, edite se precisar e depois clique em Gerar V√≠deo para criar seu conte√∫do.
                </p>
                <a href="http://localhost:9000" target="_blank" id="previewLink"
                    style="display: none; text-decoration: none;">
                    <button class="preview-btn">
                        Abrir Editor & Download
                        <span>‚Üí</span>
                    </button>
                </a>
            </div>

            <!-- Tips Card REMOVED -->
        </div>
    </div>

    <script>
        // Initialize Scene Inputs
        const scenesContainer = document.getElementById('scenes-container');
        for (let i = 0; i < 5; i++) {
            const div = document.createElement('div');
            div.className = 'scene-item';
            div.innerHTML = `
                <span class="scene-number">${i + 1}</span>
                <input type="text" id="prompt-${i}" class="scene-input" placeholder="Descreva a cena para a IA gerar a imagem...">
            `;
            scenesContainer.appendChild(div);
        }

        async function generateProPrompts() {
            const topic = document.getElementById('topic').value;
            const script = document.getElementById('scriptText').value;

            if (!script) {
                alert("Gere ou escreva um roteiro primeiro!");
                return;
            }

            const btn = document.getElementById('genPromptsBtn');
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<span class="loading-spinner"></span> Gerando...';

            try {
                const response = await fetch('http://localhost:3001/api/generate-prompts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ script, topic })
                });

                const data = await response.json();
                if (data.success && Array.isArray(data.prompts)) {
                    data.prompts.forEach((prompt, index) => {
                        if (index < 5) {
                            document.getElementById(`prompt-${index}`).value = prompt;
                        }
                    });
                } else {
                    alert("Erro ao gerar prompts: " + (data.error || "Formato inv√°lido"));
                }
            } catch (e) {
                alert("Erro de conex√£o: " + e.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }

        async function generateScript() {
            const topic = document.getElementById('topic').value;
            if (!topic) {
                alert("Por favor, digite um t√≥pico.");
                return;
            }

            const btn = document.getElementById('genScriptBtn');
            const scriptArea = document.getElementById('scriptText');
            const originalText = btn.innerHTML;

            btn.disabled = true;
            btn.innerHTML = '<span class="loading-spinner"></span> Escrevendo...';

            try {
                const response = await fetch('http://localhost:3001/api/generate-script', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ topic })
                });
                const data = await response.json();
                if (data.success) {
                    scriptArea.value = data.script;
                } else {
                    alert("Erro ao gerar roteiro: " + data.error);
                }
            } catch (e) {
                alert("Erro de conex√£o: " + e.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }

        async function generateVideo() {
            const script = document.getElementById('scriptText').value;
            const voice = document.getElementById('voice').value;

            if (!script) {
                alert("Por favor, escreva ou gere um roteiro primeiro.");
                return;
            }

            const btn = document.getElementById('generateBtn');
            const statusTitle = document.getElementById('statusTitle');
            const statusText = document.getElementById('statusText');
            const statusIcon = document.getElementById('statusIcon');
            const previewLink = document.getElementById('previewLink');
            const originalText = btn.innerHTML;

            btn.disabled = true;
            btn.innerHTML = '<span class="loading-spinner"></span> Gerando v√≠deo...';

            statusTitle.innerText = "Processando...";
            statusText.innerText = "Gerando √°udio, imagens e montando seu v√≠deo. Isso pode levar 1-2 minutos.";
            // Feather Icon: loader
            statusIcon.innerHTML = `<svg class="icon icon-lg" viewBox="0 0 24 24"><line x1="12" y1="2" x2="12" y2="6"></line><line x1="12" y1="18" x2="12" y2="22"></line><line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line><line x1="2" y1="12" x2="6" y2="12"></line><line x1="18" y1="12" x2="22" y2="12"></line><line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line><line x1="16.24" y1="7.76" x2="19.07" y2="4.93"></line></svg>`;
            statusIcon.style.animation = "spin 2s infinite linear";
            previewLink.style.display = 'none';

            try {
                // Collect prompts
                const prompts = [];
                for (let i = 0; i < 5; i++) {
                    const val = document.getElementById(`prompt-${i}`).value;
                    if (val.trim()) prompts.push(val);
                }

                // Get reference image URL if uploaded
                const referenceImageUrl = window.uploadedReferenceImageUrl || null;

                const response = await fetch('http://localhost:3001/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ script, voice, imagePrompts: prompts, referenceImageUrl })
                });

                const data = await response.json();

                if (data.success) {
                    statusTitle.innerText = "V√≠deo Pronto! üéâ";
                    statusText.innerText = "Seu v√≠deo foi gerado com sucesso. Clique no bot√£o abaixo para visualizar e baixar.";
                    // Feather Icon: check-circle
                    statusIcon.innerHTML = `<svg class="icon icon-lg" viewBox="0 0 24 24"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>`;
                    statusIcon.style.animation = "none";
                    previewLink.style.display = 'block';
                } else {
                    statusTitle.innerText = "Erro na Gera√ß√£o";
                    statusText.innerText = data.error || "Ocorreu um erro ao gerar o v√≠deo.";
                    // Feather Icon: x-circle
                    statusIcon.innerHTML = `<svg class="icon icon-lg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>`;
                    statusIcon.style.animation = "none";
                }
            } catch (e) {
                statusTitle.innerText = "Erro de Conex√£o";
                statusText.innerText = e.message;
                // Feather Icon: alert-triangle
                statusIcon.innerHTML = `<svg class="icon icon-lg" viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>`;
                statusIcon.style.animation = "none";
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }

        // Reference Image Upload Logic
        window.uploadedReferenceImageUrl = null;

        const uploadZone = document.getElementById('uploadZone');
        const referenceImageInput = document.getElementById('referenceImageInput');
        const uploadPlaceholder = document.getElementById('uploadPlaceholder');
        const uploadPreview = document.getElementById('uploadPreview');
        const uploadRemoveBtn = document.getElementById('uploadRemoveBtn');

        uploadZone.addEventListener('click', () => referenceImageInput.click());

        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });

        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('dragover');
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                handleFileUpload(file);
            }
        });

        referenceImageInput.addEventListener('change', (e) => {
            if (e.target.files[0]) {
                handleFileUpload(e.target.files[0]);
            }
        });

        uploadRemoveBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            resetUpload();
        });

        async function handleFileUpload(file) {
            const formData = new FormData();
            formData.append('referenceImage', file);

            // Show local preview immediately
            const reader = new FileReader();
            reader.onload = (e) => {
                uploadPreview.src = e.target.result;
                uploadPreview.style.display = 'block';
                uploadPlaceholder.style.display = 'none';
                uploadRemoveBtn.style.display = 'flex';
                uploadZone.classList.add('has-image');
            };
            reader.readAsDataURL(file);

            try {
                const response = await fetch('http://localhost:3001/api/upload-reference', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                if (data.success) {
                    window.uploadedReferenceImageUrl = data.imageUrl;
                    console.log('Reference image uploaded:', data.imageUrl);
                } else {
                    alert('Erro ao fazer upload: ' + data.error);
                    resetUpload();
                }
            } catch (err) {
                alert('Erro de conex√£o ao fazer upload: ' + err.message);
                resetUpload();
            }
        }

        function resetUpload() {
            window.uploadedReferenceImageUrl = null;
            uploadPreview.style.display = 'none';
            uploadPreview.src = '';
            uploadPlaceholder.style.display = 'block';
            uploadRemoveBtn.style.display = 'none';
            uploadZone.classList.remove('has-image');
            referenceImageInput.value = '';
        }
    </script>
</body>

</html>